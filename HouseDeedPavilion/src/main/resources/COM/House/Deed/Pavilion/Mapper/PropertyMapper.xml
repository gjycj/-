<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="COM.House.Deed.Pavilion.Mapper.PropertyMapper"> <!-- 替换为实际包路径 -->

    <!-- 根据ID查询楼盘 -->
    <select id="selectById" parameterType="java.lang.Long" resultType="COM.House.Deed.Pavilion.Entity.Property">
        SELECT
            id, name, address, developer, property_type, completion_year,
            property_company, property_fee, description, longitude, latitude,
            created_at, updated_at, created_by, updated_by
        FROM property
        WHERE id = #{id}
    </select>

    <!-- 分页查询楼盘 -->
    <select id="selectByPage" resultType="COM.House.Deed.Pavilion.Entity.Property"> <!-- 替换为实体类全路径 -->
        SELECT
        id, name, address, developer, property_type, completion_year,
        property_company, property_fee, description, longitude, latitude,
        created_at, updated_at, created_by, updated_by
        FROM property
        <where>
            <!-- 条件筛选：如果propertyType不为null，则添加筛选条件 -->
            <if test="propertyType != null and propertyType != ''">
                AND property_type = #{propertyType}
            </if>
        </where>
        ORDER by id DESC <!-- 按ID倒序，可根据需求调整排序字段 -->
    </select>

    <!-- 多条件分页查询楼盘 -->
    <select id="selectByCondition" parameterType="COM.House.Deed.Pavilion.DTO.PropertyQueryDTO" resultType="COM.House.Deed.Pavilion.Entity.Property">
        SELECT
        id, name, address, developer, property_type, completion_year,
        property_company, property_fee, description, longitude, latitude,
        created_at, updated_at, created_by, updated_by
        FROM property
        <where>
            <!-- 名称模糊查询 -->
            <if test="nameLike != null and nameLike != ''">
                AND name LIKE CONCAT('%', #{nameLike}, '%')
            </if>
            <!-- 物业类型精确匹配 -->
            <if test="propertyType != null and propertyType != ''">
                AND property_type = #{propertyType}
            </if>
            <!-- 建成年代范围查询 -->
            <if test="completionYearStart != null and completionYearEnd != null">
                AND completion_year BETWEEN #{completionYearStart} AND #{completionYearEnd}
            </if>
            <!-- 仅起始年份：>= 起始年份（转义 ">" 为 "&gt;"） -->
            <if test="completionYearStart != null and completionYearEnd == null">
                AND completion_year &gt;= #{completionYearStart}
            </if>
            <!-- 仅结束年份：<= 结束年份（转义 "<" 为 "&lt;"） -->
            <if test="completionYearStart == null and completionYearEnd != null">
                AND completion_year &lt;= #{completionYearEnd}
            </if>
            <!-- 开发商模糊查询 -->
            <if test="developerLike != null and developerLike != ''">
                AND developer LIKE CONCAT('%', #{developerLike}, '%')
            </if>
        </where>
        ORDER BY id DESC
    </select>

    <!-- 新增楼盘 -->
    <insert id="insert" parameterType="COM.House.Deed.Pavilion.Entity.Property"> <!-- 替换为实体类全路径 -->
        INSERT INTO property (
        name, address, developer, property_type, completion_year,
        property_company, property_fee, description, longitude, latitude,
        created_at, updated_at, created_by, updated_by
        ) VALUES (
        #{name}, #{address}, #{developer}, #{propertyType}, #{completionYear},
        #{propertyCompany}, #{propertyFee}, #{description}, #{longitude}, #{latitude},
        #{createdAt}, #{updatedAt}, #{createdBy}, #{updatedBy}
        )
    </insert>

    <!-- 更新楼盘信息 -->
    <update id="updateById" parameterType="COM.House.Deed.Pavilion.Entity.Property">
        UPDATE property
        <set>
            <if test="name != null">name = #{name},</if>
            <if test="address != null">address = #{address},</if>
            <if test="developer != null">developer = #{developer},</if>
            <if test="propertyType != null">property_type = #{propertyType},</if>
            <if test="completionYear != null">completion_year = #{completionYear},</if>
            <if test="propertyCompany != null">property_company = #{propertyCompany},</if>
            <if test="propertyFee != null">property_fee = #{propertyFee},</if>
            <if test="description != null">description = #{description},</if>
            <if test="longitude != null">longitude = #{longitude},</if>
            <if test="latitude != null">latitude = #{latitude},</if>
            <!-- 更新时间自动刷新，无需前端传递 -->
            updated_at = NOW(),
            <if test="updatedBy != null">updated_by = #{updatedBy}</if>
        </set>
        WHERE id = #{id}
    </update>

</mapper>