<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="COM.House.Deed.Pavilion.Mapper.LandlordBackupMapper">

    <!-- 基础字段映射 -->
    <resultMap id="BaseResultMap" type="COM.House.Deed.Pavilion.Entity.LandlordBackup">
        <id column="id" property="id"/>
        <result column="original_id" property="originalId"/>
        <result column="name" property="name"/>
        <result column="phone" property="phone"/>
        <result column="id_card" property="idCard"/>
        <result column="gender" property="gender"/>
        <result column="address" property="address"/>
        <result column="remark" property="remark"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="created_by" property="createdBy"/>
        <result column="updated_by" property="updatedBy"/>
        <result column="backup_time" property="backupTime"/>
        <result column="delete_reason" property="deleteReason"/>
        <result column="deleted_by" property="deletedBy"/>
    </resultMap>

    <!-- 新增备份 -->
    <insert id="insert" parameterType="COM.House.Deed.Pavilion.Entity.LandlordBackup" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO landlord_backup (
            original_id, name, phone, id_card, gender, address, remark,
            created_at, updated_at, created_by, updated_by,
            backup_time, delete_reason, deleted_by
        ) VALUES (
                     #{originalId}, #{name}, #{phone}, #{idCard}, #{gender}, #{address}, #{remark},
                     #{createdAt}, #{updatedAt}, #{createdBy}, #{updatedBy},
                     #{backupTime}, #{deleteReason}, #{deletedBy}
                 )
    </insert>

    <!-- 按ID查询 -->
    <select id="selectById" parameterType="Long" resultMap="BaseResultMap">
        SELECT * FROM landlord_backup WHERE id = #{id}
    </select>

    <!-- 按原房东ID查询 -->
    <select id="selectByOriginalId" parameterType="Long" resultMap="BaseResultMap">
        SELECT * FROM landlord_backup
        WHERE original_id = #{originalId}
        ORDER BY backup_time DESC
    </select>

    <!-- 多条件查询 -->
    <select id="selectByCondition" parameterType="COM.House.Deed.Pavilion.DTO.LandlordBackupQueryDTO" resultMap="BaseResultMap">
        SELECT * FROM landlord_backup
        <where>
            <if test="originalId != null">AND original_id = #{originalId}</if>
            <if test="nameLike != null and nameLike != ''">AND name LIKE CONCAT('%', #{nameLike}, '%')</if>
            <if test="phone != null">AND phone = #{phone}</if>
            <if test="backupTimeStart != null">AND backup_time >= #{backupTimeStart}</if>
            <if test="backupTimeEnd != null">AND backup_time &lt;= #{backupTimeEnd}</if>
            <if test="deletedBy != null">AND deleted_by = #{deletedBy}</if>
        </where>
        ORDER BY backup_time DESC
    </select>

    <!-- 按ID删除 -->
    <delete id="deleteById" parameterType="Long">
        DELETE FROM landlord_backup WHERE id = #{id}
    </delete>

    <!-- 批量删除 -->
    <delete id="deleteByIds" parameterType="java.util.List">
        DELETE FROM landlord_backup WHERE id IN
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

</mapper>